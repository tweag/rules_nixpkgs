# bazel-run-nix-shell-example

A simple example of how to use `run_nix_shell`.

## How to use `run_nix_shell`

This example demonstrates how to use the `run_nix_shell` rule to execute shell
commands in a Nix-provided environment within Bazel.

1. Define a Nix shell environment

In your `WORKSPACE`, use `nixpkgs_env` to create a minimal Nix shell environment
with the packages you need:

```bzl
nixpkgs_env(
    name = "my_env",
    pkgs = ["cowsay"],  # List your required Nix packages here
    repository = "@nixpkgs",
)
```

This generates a `stdenv` file that sets up the PATH for the specified packages.

2. Use `run_nix_shell` in your BUILD file

Define a `run_nix_shell` target that uses the generated environment:

```bzl
run_nix_shell(
   name = "my_shell",
   outputs = ["hello.txt"],
   cmd = "cowsay 'hello nix!' > $1",
   stdenv = "@my_env//:stdenv",
)
```

- `outputs`: The files to generate.
- `cmd`: The shell command to run (can use `$1`, `$2`, etc, for the output files).
- `stdenv`: The environment file generated by `nixpkgs_env`.

3. Build and run

Build the target with Bazel:

```sh
bazel build :my_shell
```

The output file (`hello.txt`) will be created using the Nix shell environment
with your specified packages.
